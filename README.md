# spring-oauth2-keycloak

### Things todo list:

1. Clone this repository: `git clone https://github.com/hendisantika/spring-oauth2-keycloak.git`
2. Navigate to the folder: `cd spring-oauth2-keycloak`
3. Run the Keycloak application: https://github.com/keycloak/keycloak-containers/tree/main/docker-compose-examples
4. Create Keycloak Admin username & password
5. Run the application: `mvn clean spring-boot:run`
6. Run Keycloak via Docker

```shell
docker run -p 8081:8080 -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:17.0.1 start-dev
``` 

Get JWT

```shell
curl --location --request GET 'http://localhost:8080/auth/realms/PowerRanger/.well-known/openid-configuration' \
--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJFVXdKTHNOZEVmWHJ4b29tZEd5SUF5dU50MnhQSGMwWjlPT3BPM2RTUXpzIn0.eyJleHAiOjE2NjEzNDYxNTYsImlhdCI6MTY2MTM0NTU1NiwiYXV0aF90aW1lIjoxNjYxMzQ0Njg5LCJqdGkiOiIzNzM3NmMzNS1lZTE1LTQ4NzktOGQ3Yy1kZjYxOTFhOGIxYzkiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL1Bvd2VyUmFuZ2VyIiwic3ViIjoiYjVlZTdkMTMtMDhjMC00ZTk1LWEyNGItZmI1MjU4YTZjMDdkIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiZW1wbG95ZWUtc2VydmljZSIsInNlc3Npb25fc3RhdGUiOiI5MjZkYTgwZS0xMjU4LTQ2OTMtYmY4Ny0wYzA1NjM4ZGM1M2QiLCJhY3IiOiIwIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJlbXBsb3llZS1zZXJ2aWNlIjp7InJvbGVzIjpbIlVTRVIiXX19LCJzY29wZSI6Im9wZW5pZCBlbWFpbCBwcm9maWxlIiwic2lkIjoiOTI2ZGE4MGUtMTI1OC00NjkzLWJmODctMGMwNTYzOGRjNTNkIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJ1c2VyX25hbWUiOiJuYXJ1dG9AeW9wbWFpbC5jb20iLCJuYW1lIjoiVXp1bWFraSBOYXJ1dG8iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJuYXJ1dG9AeW9wbWFpbC5jb20iLCJnaXZlbl9uYW1lIjoiVXp1bWFraSIsImZhbWlseV9uYW1lIjoiTmFydXRvIiwiZW1haWwiOiJuYXJ1dG9AeW9wbWFpbC5jb20ifQ.b1IVmMKuLxYHkxWqNndHilg290X8dHIRSVOUMjHMMqFSN9BVMmzms5lUqGrGM9W0cAj7ZzeqyhHwuHD1s0X5H722JaH77GRGCUgUbyCgiL0XYKT1dfny3xn6kyBtI-_H9ycETMVkMiqcXVRg8f9nH4N93gDKI7DqaVtydW3UkUFejUQJ1KINnouFoO_EZhUElg0leloPrN3g8nQxGarfSpFBOfY7FjiKuubQFK79ivf7qxMh8q1CobefgBr72fU42HzvtQDTM3Q2KAbC6uyasuO4KusBLNyKYd8hiGLJCcnwn5q4DfK5CLyWCT_PLkDULaaw-AU9B52J0Rl-AEs8sQ'
```

Get Username

```shell
curl --location --request GET 'localhost:8081/api/v1/employees/username' \
--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJFVXdKTHNOZEVmWHJ4b29tZEd5SUF5dU50MnhQSGMwWjlPT3BPM2RTUXpzIn0.eyJleHAiOjE2NjEzNDYxNTYsImlhdCI6MTY2MTM0NTU1NiwiYXV0aF90aW1lIjoxNjYxMzQ0Njg5LCJqdGkiOiIzNzM3NmMzNS1lZTE1LTQ4NzktOGQ3Yy1kZjYxOTFhOGIxYzkiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL1Bvd2VyUmFuZ2VyIiwic3ViIjoiYjVlZTdkMTMtMDhjMC00ZTk1LWEyNGItZmI1MjU4YTZjMDdkIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiZW1wbG95ZWUtc2VydmljZSIsInNlc3Npb25fc3RhdGUiOiI5MjZkYTgwZS0xMjU4LTQ2OTMtYmY4Ny0wYzA1NjM4ZGM1M2QiLCJhY3IiOiIwIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJlbXBsb3llZS1zZXJ2aWNlIjp7InJvbGVzIjpbIlVTRVIiXX19LCJzY29wZSI6Im9wZW5pZCBlbWFpbCBwcm9maWxlIiwic2lkIjoiOTI2ZGE4MGUtMTI1OC00NjkzLWJmODctMGMwNTYzOGRjNTNkIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJ1c2VyX25hbWUiOiJuYXJ1dG9AeW9wbWFpbC5jb20iLCJuYW1lIjoiVXp1bWFraSBOYXJ1dG8iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJuYXJ1dG9AeW9wbWFpbC5jb20iLCJnaXZlbl9uYW1lIjoiVXp1bWFraSIsImZhbWlseV9uYW1lIjoiTmFydXRvIiwiZW1haWwiOiJuYXJ1dG9AeW9wbWFpbC5jb20ifQ.b1IVmMKuLxYHkxWqNndHilg290X8dHIRSVOUMjHMMqFSN9BVMmzms5lUqGrGM9W0cAj7ZzeqyhHwuHD1s0X5H722JaH77GRGCUgUbyCgiL0XYKT1dfny3xn6kyBtI-_H9ycETMVkMiqcXVRg8f9nH4N93gDKI7DqaVtydW3UkUFejUQJ1KINnouFoO_EZhUElg0leloPrN3g8nQxGarfSpFBOfY7FjiKuubQFK79ivf7qxMh8q1CobefgBr72fU42HzvtQDTM3Q2KAbC6uyasuO4KusBLNyKYd8hiGLJCcnwn5q4DfK5CLyWCT_PLkDULaaw-AU9B52J0Rl-AEs8sQ'
```

Get User Role

```shell
curl --location --request GET 'localhost:8081/api/v1/employees/roles' \
--header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJFVXdKTHNOZEVmWHJ4b29tZEd5SUF5dU50MnhQSGMwWjlPT3BPM2RTUXpzIn0.eyJleHAiOjE2NjEzNDYxNTYsImlhdCI6MTY2MTM0NTU1NiwiYXV0aF90aW1lIjoxNjYxMzQ0Njg5LCJqdGkiOiIzNzM3NmMzNS1lZTE1LTQ4NzktOGQ3Yy1kZjYxOTFhOGIxYzkiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL1Bvd2VyUmFuZ2VyIiwic3ViIjoiYjVlZTdkMTMtMDhjMC00ZTk1LWEyNGItZmI1MjU4YTZjMDdkIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiZW1wbG95ZWUtc2VydmljZSIsInNlc3Npb25fc3RhdGUiOiI5MjZkYTgwZS0xMjU4LTQ2OTMtYmY4Ny0wYzA1NjM4ZGM1M2QiLCJhY3IiOiIwIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJlbXBsb3llZS1zZXJ2aWNlIjp7InJvbGVzIjpbIlVTRVIiXX19LCJzY29wZSI6Im9wZW5pZCBlbWFpbCBwcm9maWxlIiwic2lkIjoiOTI2ZGE4MGUtMTI1OC00NjkzLWJmODctMGMwNTYzOGRjNTNkIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJ1c2VyX25hbWUiOiJuYXJ1dG9AeW9wbWFpbC5jb20iLCJuYW1lIjoiVXp1bWFraSBOYXJ1dG8iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJuYXJ1dG9AeW9wbWFpbC5jb20iLCJnaXZlbl9uYW1lIjoiVXp1bWFraSIsImZhbWlseV9uYW1lIjoiTmFydXRvIiwiZW1haWwiOiJuYXJ1dG9AeW9wbWFpbC5jb20ifQ.b1IVmMKuLxYHkxWqNndHilg290X8dHIRSVOUMjHMMqFSN9BVMmzms5lUqGrGM9W0cAj7ZzeqyhHwuHD1s0X5H722JaH77GRGCUgUbyCgiL0XYKT1dfny3xn6kyBtI-_H9ycETMVkMiqcXVRg8f9nH4N93gDKI7DqaVtydW3UkUFejUQJ1KINnouFoO_EZhUElg0leloPrN3g8nQxGarfSpFBOfY7FjiKuubQFK79ivf7qxMh8q1CobefgBr72fU42HzvtQDTM3Q2KAbC6uyasuO4KusBLNyKYd8hiGLJCcnwn5q4DfK5CLyWCT_PLkDULaaw-AU9B52J0Rl-AEs8sQ'
```

### Source Article:

* https://medium.com/@bcarunmail/securing-rest-api-using-keycloak-and-spring-oauth2-6ddf3a1efcc2
* https://medium.com/@bcarunmail/accessing-secure-rest-api-using-spring-oauth2resttemplate-ef18377e2e05
* https://temfack.com/keycloak-sso-on-linux-server-with-docker-and-ssl/ 